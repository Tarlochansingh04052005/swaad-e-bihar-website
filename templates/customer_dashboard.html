{% extends "public_base.html" %}
{% block content %}
<section class="menu" style="padding-top: 2rem;">
  <div class="section__title">
    <p class="eyebrow">Customer dashboard</p>
    <h2>Welcome back, {{ customer.name }}.</h2>
  </div>

  <div class="panel" style="margin-top: 2rem;">
    <h2>Your recent orders</h2>
    {% if orders %}
    <table>
      <thead>
        <tr>
          <th>Reference</th>
          <th>Order</th>
          <th>Status</th>
          <th>Total</th>
          <th>Placed</th>
          <th>Updated</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.order_reference or order.id }}</td>
          <td>{{ order.items }}</td>
          <td><span class="badge">{{ order.status }}</span></td>
          <td>â‚¹{{ order.total_amount }}</td>
          <td>{{ order.created_at }}</td>
          <td>{{ order.updated_at or order.created_at }}</td>
        </tr>
        {% if events_by_order.get(order.id) %}
        <tr>
          <td colspan="6">
            <div class="muted" style="margin: 6px 0 10px;">
              Status history:
              {% for event in events_by_order.get(order.id)[:4] %}
              <span style="margin-right: 10px;">{{ event.status }} ({{ event.created_at }})</span>
              {% endfor %}
            </div>
          </td>
        </tr>
        {% endif %}
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="muted">No orders yet. Place your first order to see it here.</p>
    {% endif %}
  </div>
</section>
{% endblock %}
